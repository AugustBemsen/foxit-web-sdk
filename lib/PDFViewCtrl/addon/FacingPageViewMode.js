!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("PDFViewCtrl")):"function"==typeof define&&define.amd?define(["PDFViewCtrl"],t):"object"==typeof exports?exports.FacingPageViewMode=t(require("PDFViewCtrl")):e.FacingPageViewMode=t(e.PDFViewCtrl)}(self,(function(e){return function(e){var t={};function o(i){if(t[i])return t[i].exports;var r=t[i]={i:i,l:!1,exports:{}};return e[i].call(r.exports,r,r.exports,o),r.l=!0,r.exports}return o.m=e,o.c=t,o.d=function(e,t,i){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(o.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)o.d(i,r,function(t){return e[t]}.bind(null,r));return i},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="",o(o.s=0)}([function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=o(1),r=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t.default=e,t}(o(2));function n(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):function(e,t){for(var o=Object.getOwnPropertyNames(t),i=0;i<o.length;i++){var r=o[i],n=Object.getOwnPropertyDescriptor(t,r);n&&n.configurable&&void 0===e[r]&&Object.defineProperty(e,r,n)}}(e,t))}var s=r.IViewMode,a=r.ViewerEvents,c=r.vendors,l=r.shared,d=c.jQuery,h=l.keyboardStatus,u=2,p=10,g=function(e){function t(o){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var i=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,e.call(this,o));return i.multipage=u,i.pageSpacing=p,i.isMouseDown=!1,i.isScroll=!1,i.isWheel=!1,i.isMoveToBottom=!1,i.isMoveToTop=!1,i.wheel=i.wheel.bind(i),i.mouseDown=i.mouseDown.bind(i),i.mouseUp=i.mouseUp.bind(i),i.adjust=i.adjust.bind(i),i.keyup=i.keyup.bind(i),i.isJump=!1,i}return n(t,e),t.getName=function(){return"facing-page-view-mode"},t.setMultipage=function(e){u=e},t.getMultipage=function(){return u},t.setPageSpacing=function(e){p=e},t.getPageSpacing=function(){return p},t.prototype.getItems=function(){return d(e.prototype.getItems.call(this))},t.prototype.into=function(t,o){var i=this;e.prototype.into.call(this,t,o);var r=["<style>",".facing-page-view-mode{","overflow:hidden;","margin:0 auto;","}",".facing-page-view-mode .fv__pdf-view-mode-item{","float: left;","display: -webkit-box;","display: -ms-flexbox;","display: -webkit-flex;","display: flex;","-ms-flex-pack: center;","-ms-flex-align: center;","-ms-justify-content: center;","-webkit-justify-content: center;","justify-content: center;","align-items: center;","width:calc("+100/this.multipage+"% - "+this.pageSpacing*(this.multipage-1)/this.multipage+"px)","}",".facing-page-view-mode .fv__pdf-view-mode-item{","margin-right: "+this.pageSpacing+"px;","}",".facing-page-view-mode .fv__pdf-page-layout{","width: 100%;","}",".facing-page-view-mode .fv__pdf-view-mode-item:nth-child("+this.multipage+"n){","margin-right: 0;","}",".facing-page-view-mode .fv__pdf-view-mode-item:nth-of-type(odd) .fv__pdf-page-layout{","margin-right: 0;","margin-left: 0px","}",".facing-page-view-mode .fv__pdf-view-mode-item:nth-of-type(even) .fv__pdf-page-layout{","margin-left: 0;","}","</style>"].join("");this.$style=d(r),this.docRender.$container.after(this.$style),this.docRender.$container.addClass(this.constructor.getName());var n=this.docRender.viewerRender.scrollWrap;this.scrollHost=n.getScrollHost(),this.currentScrollTop=n.getScrollTop(),this.initPageLayout(),this.bindScrollEvent(),this.wheelHandler=f(200,this.wheel),this.scrollHost.addEventListener("wheel",this.wheelHandler),this.scrollHost.addEventListener("mousedown",this.mouseDown),window.addEventListener("mouseup",this.mouseUp),window.addEventListener("keyup",this.keyup),this.docRender.pdfViewer.eventEmitter.on(a.zoomToSuccess,this.adjust),this.goToPage(this.docRender.getCurrentPageIndex()),(this.hammer=new Hammer.Manager(this.scrollHost,{recognizers:[[Hammer.Pan,{direction:Hammer.DIRECTION_ALL}]]})).on("panend",(function(e){if("hand"===i.docRender.pdfViewer.getStateHandlerManager().getCurrentStates().getStateName())return e&&8===e.direction&&(i.isMoveToBottom=!0),e&&16===e.direction&&(i.isMoveToTop=!0),e&&1===e.direction&&(e.deltaY>0?i.isMoveToTop=!0:i.isMoveToBottom=!0),i.isNeedAdjust=!0,i.adjust(),!1}))},t.prototype.bindScrollEvent=function(){var e=this;this._unwatchScrollEvent&&this._unwatchScrollEvent();var t=this.docRender.viewerRender.scrollWrap,o=!1,i=f(150,(function(t){o||e.isMouseDown||e.isWheel||!e.isScroll||(e.scroll(t),e.isWheel=!1)})),r=t.addScrollEventListener((function(){h.isCtrlDown||(e.isScroll=!0,i(t.getScrollTop()-e.currentScrollTop),e.currentScrollTop=t.getScrollTop(),clearTimeout(e.scrollEventTimer),e.scrollEventTimer=setTimeout((function(){if(!o){e.isScroll=!1;var t=e.docRender;if(t){var i=e.docRender.pagesRender;i&&i.renderVisiblePages().then((function(){if(!o){e.getCurrentPageIndex();t.isGoto?setTimeout((function(){t.isGoto=!1}),40):t.setCurrentPageIndex(e.getCurrentPageIndex()),e.isNeedAdjust&&!e.isJump&&e.adjust(),e.isJump=!1}})).catch((function(){}))}}}),100))}));this._unwatchScrollEvent=function(){e._unwatchScrollEvent=function(){},o=!0,r()}},t.prototype.initPageLayout=function(){for(var e=this.getItems(),t=this.multipage,o=this.pageSpacing*(t-1)/t,i=0;i<e.length;i++)e.eq(i).css({width:"calc("+100/t+"% - "+o+"px)"})},t.prototype.keyup=function(e){var t=this;this.reset();var o=e.keyCode;o!==i.KeyCodes.PageDown&&o!==i.KeyCodes.DownArrow||(this.isMoveToBottom=!0),o!==i.KeyCodes.UpArrow&&o!==i.KeyCodes.PageUp||(this.isMoveToTop=!0),o===i.KeyCodes.PageUp||o===i.KeyCodes.PageDown?setTimeout((function(){t.isNeedAdjust=!0}),50):o!==i.KeyCodes.UpArrow&&o!==i.KeyCodes.DownArrow||(this.isNeedAdjust=!0)},t.prototype.wheel=function(e){if(!h.isCtrlDown&&this.docRender){this.isWheel=!0;var t=this.docRender.viewerRender.scrollWrap;this.currentPageIndex=this.getCurrentPageIndex();t.getHeight(),t.getScrollLeft(),this.getItems().eq(this.currentPageIndex).children(".fv__pdf-page-layout").height();if(this.getVisibleIndexes().length>2)if(e.deltaY>0){var o=this.docRender.doc.getPageCount(),i=this.currentPageIndex+2;this.goToPage(Math.min(i,o-1))}else{var r=this.currentPageIndex-2;r<=0&&(r=0),this.goToPage(r)}}},t.prototype.mouseDown=function(e){this.isMouseDown=!0,this.startPointY=e.screenY;var t=this.docRender.viewerRender.scrollWrap.getScrollHost(),o=d(t).offset(),i=o.top,r=o.left,n=r+t.clientWidth,s=i+t.clientHeight;this.dragging=!0;var a=e.clientX,c=e.clientY;this.scrollType=r<=a&&a<=n&&i<=c&&c<=s?0:n<a&&i<c?1:2},t.prototype.mouseUp=function(e){this.isMouseDown=!1,this.isNeedAdjust=!0},t.prototype.goToPage=function(e,t){this.reset();var o=this.getItems(),i=o.get(e),r=o.eq(e),n=i.offsetHeight,s=(i.offsetWidth,parseInt(r.css("margin-top"))),a=this.docRender.viewerRender.scrollWrap,c=a.getHeight(),l=a.getScrollOffsetLeft(),d=i.offsetTop;d=t?r.position().top+n-c+s+s/2:r.position().top+s/2,a.scrollTo(l,d)},t.prototype.adjust=function(){if(this.isScroll||2===this.scrollType)return!1;var e=this.getVisibleIndexes(),t=this.docRender.viewerRender.scrollWrap,o=t.getScrollTop(),i=(t.getScrollLeft(),this.scrollHost.clientHeight,this.getCurrentPageIndex());if(e.length>2)return this.isMoveToBottom&&(i=e[2]),this.isMoveToTop&&(i=e[0]),this.goToPage(i);this.reset()},t.prototype.reset=function(){this.isMoveToBottom=!1,this.isMoveToTop=!1,this.isNeedAdjust=!1},t.prototype.scroll=function(e){this.docRender.doc.getPageCount();var t=this.docRender.viewerRender.scrollWrap,o=t.getScrollTop(),i=(this.lastScrollTop,t.getScrollLeft(),this.scrollHost.clientHeight,this.currentPageIndex,this.getItems(),this.getVisibleIndexes());if(i.length>2){if(e>0){var r=i[2]||i[0];this.goToPage(r)}if(e<0){var n=i[0]||0;this.goToPage(n)}}},t.prototype.renderViewMode=function(e,t,o,i,r){var n=this;if(this.docRender){var s=e.index,a=this.getMaxPageWidth(),c=this.multipage,l=(c-1)*this.pageSpacing;this.docRender.pagesRender.$ui.css({width:a*c*t+l});for(var h=Math.floor(s/c),u=0,p=this.docRender.doc.getPageCount(),g=this.docRender.viewerRender.scrollWrap.getHeight(),f=[],v=this.docRender.getRotation(),m=0;m<c;m++){var w=h*c+m;w<p&&f.push(this.docRender.getPDFDoc().getPageByIndex(w).then((function(e){var t=void 0;t=90===v||270===v?e.getPxWidth():e.getPxHeight(),u=Math.max(t,u),t})))}Promise.all(f).then((function(){var e=n.getItems(),o=u*t;o<g?d(e[s]).css({height:"calc("+g+"px - 1rem)"}):d(e[s]).css({height:o})})).catch((function(e){0}))}},t.prototype.getMaxPageWidth=function(){var e=0,t=this.docRender.doc,o=this.docRender.getRotation(),i="width";90!==o&&270!==o||(i="height");var r=t.getPageSizesSync();for(var n in r){var s=4*r[n][i]/3;s>e&&(e=s)}return e},t.prototype.jumpToPage=function(e,t){var o=this,i=t.x,r=void 0===i?0:i,n=t.y,s=void 0===n?0:n;this.isJump=!0;var a=this.getItems();e>=a.length?e=a.length-1:e<0&&(e=0);var c=a.eq(e),l=c.position().left+r,d=this.docRender.viewerRender.scrollWrap.getHeight(),h=a.get(e).offsetHeight,u=h/2;s>u&&(s=u);var p=c.position().top+s,g=parseInt(c.css("margin-top"));h<d&&(p=c.position().top+g/2),this._unwatchScrollEvent&&this._unwatchScrollEvent(),this.docRender.viewerRender.scrollWrap.scrollTo(l,p),this.currentJumpPageIndex=e,this.docRender.setCurrentPageIndex(e),setTimeout((function(){o.bindScrollEvent()}))},t.prototype.getFitHeight=function(e){var t=this.docRender.viewerRender.scrollWrap;return t.getHeight()-t.getScrollOffsetTop()},t.prototype.getFitWidth=function(e){var t=this.getMaxPageWidth(),o=this.docRender.getRotation(),i="width";90!==o&&270!==o||(i="height");var r=this.docRender.viewerRender.scrollWrap,n=this.multipage,s=(r.getWidth()-16-n*this.pageSpacing)/n,a=this.docRender.doc.getPageSize(e);if(a)return s*a[i]*4/(3*t)},t.prototype.getVisibleIndexes=function(){for(var e=this.getItems(),t=this.docRender.viewerRender.scrollWrap,o=t.getScrollTop(),i=o+t.getHeight(),r=t.getScrollLeft(),n=r+t.getWidth(),s=function(e){var t=d(e).width(),s=d(e).height(),a=e.offsetTop,c=a+s,l=e.offsetLeft,h=l+t;if(l<=n&&h>=r&&c>=o&&a<=i){var u=Math.max(r,l),p=Math.min(n,h),g=Math.max(o,a);if((p-u)*(Math.min(i,c)-g)>5*Math.max(h-l,c-a))return!0}return!1},a=[],c=e.length,l=0;l<c;l+=2){if(s(e[l]))a.push(l),l<e.length-1&&a.push(l+1);else if(l<c-1){s(e[l+1])&&(a.push(l),a.push(l+1))}}return a},t.prototype.out=function(){this.docRender.$container.removeClass(this.constructor.getName()),this.docRender.pagesRender.$ui.removeAttr("style"),this.$style&&this.$style.remove(),this._unwatchScrollEvent&&this._unwatchScrollEvent();for(var t=this.getItems(),o=0;o<t.length;o++)d(t[o]).css({width:"",height:""});this.scrollHost&&this.scrollHost.removeEventListener("wheel",this.wheelHandler),this.scrollHost&&this.scrollHost.removeEventListener("mousedown",this.mouseDown),window.removeEventListener("mouseup",this.mouseUp),window.removeEventListener("keyup",this.keyup),this.docRender.pdfViewer.eventEmitter.off(a.zoomToSuccess,this.adjust),this.hammer.destroy(),e.prototype.out.call(this)},t.prototype.getCurrentPageIndex=function(){if(this.isJump)return this.currentJumpPageIndex;for(var e=this.getItems(),t=this.docRender.viewerRender.scrollWrap,o=t.getScrollTop(),i=o+t.getHeight(),r=t.getScrollLeft(),n=r+t.getWidth(),s=this.currentPageIndex,a=[],c=0;c<e.length;c++){var l=e[c],h=d(l).width(),u=d(l).height(),p=l.offsetTop,g=p+u,f=l.offsetLeft,v=f+h;if(f<=n&&v>=r&&g>=o&&p<=i){var m=Math.max(r,f),w=Math.min(n,v),_=Math.max(o,p),y=(w-m)*(Math.min(i,g)-_);a.push({index:c,areaSize:y})}}if(0===a.length)return s;var P=0;return a.forEach((function(e,t){e.areaSize>a[P].areaSize&&(P=t)})),a[P].index},t.prototype.getNextPageIndex=function(){var e=this.docRender.doc.getPageCount(),t=this.getCurrentPageIndex();if(t<e-1){var o=this.docRender.viewerRender.scrollWrap,i=this.docRender.pagesRender.$ui.width(),r=o.getWidth()-16,n=this.multipage;if(r>=i)t=Math.ceil((t+1)/n)*n;else t++}return t>e-1&&(t=e-1),t},t.prototype.getPrevPageIndex=function(){var e=this.getCurrentPageIndex();if(e>0){var t=this.docRender.viewerRender.scrollWrap,o=this.docRender.pagesRender.$ui.width(),i=t.getWidth()-16,r=this.multipage;if(i>=o)e=(Math.ceil((e+1)/r)-2)*r;else e--}return e<0&&(e=0),e},t}(s);t.default=g;var f=function(e,t){var o=void 0;return function(){var i=this,r=arguments;clearTimeout(o),o=setTimeout((function(){t.apply(i,r)}),e)}}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.KeyCodes={Unknown:0,Backspace:8,Tab:9,Enter:13,Shift:16,Ctrl:17,Alt:18,PauseBreak:19,CapsLock:20,Escape:27,Space:32,PageUp:33,PageDown:34,End:35,Home:36,LeftArrow:37,UpArrow:38,RightArrow:39,DownArrow:40,Insert:45,Delete:46,KEY_0:48,KEY_1:49,KEY_2:50,KEY_3:51,KEY_4:52,KEY_5:53,KEY_6:54,KEY_7:55,KEY_8:56,KEY_9:57,KEY_A:65,KEY_B:66,KEY_C:67,KEY_D:68,KEY_E:69,KEY_F:70,KEY_G:71,KEY_H:72,KEY_I:73,KEY_J:74,KEY_K:75,KEY_L:76,KEY_M:77,KEY_N:78,KEY_O:79,KEY_P:80,KEY_Q:81,KEY_R:82,KEY_S:83,KEY_T:84,KEY_U:85,KEY_V:86,KEY_W:87,KEY_X:88,KEY_Y:89,KEY_Z:90,Meta:91,ContextMenu:93,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,F13:124,F14:125,F15:126,F16:127,F17:128,F18:129,F19:130,NumLock:144,ScrollLock:145,US_SEMICOLON:186,US_EQUAL:187,US_COMMA:188,US_MINUS:189,US_DOT:190,US_SLASH:191,US_BACKTICK:192,US_OPEN_SQUARE_BRACKET:219,US_BACKSLASH:220,US_CLOSE_SQUARE_BRACKET:221,US_QUOTE:222,NUMPAD_0:96,NUMPAD_1:97,NUMPAD_2:98,NUMPAD_3:99,NUMPAD_4:100,NUMPAD_5:101,NUMPAD_6:102,NUMPAD_7:103,NUMPAD_8:104,NUMPAD_9:105,NUMPAD_MULTIPLY:106,NUMPAD_ADD:107,NUMPAD_SEPARATOR:108,NUMPAD_SUBTRACT:109,NUMPAD_DECIMAL:110,NUMPAD_DIVIDE:111,KEY_IN_COMPOSITION:112,ABNT_C1:113,ABNT_C2:114}},function(t,o){t.exports=e}]).default}));